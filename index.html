<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>연구용 설문 (Pre/Post)</title>
  <style>
    body { font-family: sans-serif; margin: 2em; }
    .question { margin-bottom: 1em; }
    .hidden { display: none; }
  </style>
</head>
<body>
  <h2>연구용 설문</h2>
  <form id="surveyForm"></form>
  <button id="submitBtn" class="hidden">제출하기</button>

  <script>
    // ====== 1. 질문 Pool (이후 연구자가 채워 넣을 부분) ======
    const questions = [
      { q: "샘플 질문 1", options: ["A", "B", "C"], answer: "A" },
      { q: "샘플 질문 2", options: ["True", "False"], answer: "True" },
      { q: "샘플 질문 3", options: ["빨강", "파랑", "초록"], answer: "초록" }
    ];

    // ====== 2. 랜덤 섞기 ======
    function shuffle(arr) {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    // ====== 3. 시작: 타이머 기록 ======
    const startTime = Date.now();
    const shuffledQuestions = shuffle([...questions]);
    const form = document.getElementById("surveyForm");
    const submitBtn = document.getElementById("submitBtn");

    // ====== 4. 문항 출력 ======
    shuffledQuestions.forEach((item, idx) => {
      const div = document.createElement("div");
      div.className = "question";
      div.innerHTML = `<p>Q${idx + 1}. ${item.q}</p>`;
      item.options.forEach(opt => {
        div.innerHTML += `
          <label>
            <input type="radio" name="q${idx}" value="${opt}"> ${opt}
          </label><br>`;
      });
      form.appendChild(div);
    });
    submitBtn.classList.remove("hidden");

    // ====== 5. 제출 이벤트 ======
    submitBtn.addEventListener("click", () => {
      const endTime = Date.now();
      const duration = Math.round((endTime - startTime) / 1000); // 초 단위

      let correct = 0, wrong = 0;
      const answers = [];

      shuffledQuestions.forEach((item, idx) => {
        const checked = form.querySelector(`input[name="q${idx}"]:checked`);
        const ans = checked ? checked.value : "";
        answers.push(ans);
        if (ans === item.answer) correct++;
        else wrong++;
      });

      // ====== 6. Google Apps Script URL ======
      const scriptURL = "https://script.google.com/macros/s/AKfycby4G5gWZeEz9bF49nrJeP6WXosP63OMldAB7Up9D_eFbA5NdNbqZqjUPm6dMC5zIZLjUw/exec";
      const payload = {
        respondent: "익명", // or 사용자가 입력한 ID
        phase: "pre",       // or "post"
        time: duration,
        correct: correct,
        wrong: wrong,
        answers: answers
      };

      fetch(scriptURL, {
        method: "POST",
        body: JSON.stringify(payload)
      })
      .then(res => res.json())
      .then(res => alert("응답이 저장되었습니다!\n소요시간: " + duration + "초\n정답: " + correct + "개, 오답: " + wrong + "개"))
      .catch(err => alert("에러 발생: " + err));
    });
  </script>
</body>
</html>